<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Floor Tile AR — Stock Library</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin:0; font-family:-apple-system,system-ui,Segoe UI,Roboto,sans-serif; background:#0b0c10; color:#e5e7eb; }
    main { max-width:900px; margin:0 auto; padding:16px; display:grid; gap:16px; }
    .panel { background:#111318; border:1px solid #22252c; border-radius:14px; padding:16px; }
    label { display:block; font-size:14px; margin:10px 0 6px; color:#cbd5e1 }
    select, input[type="number"] { width:100%; padding:10px; border-radius:10px; border:1px solid #2a2f39; background:#0f1116; color:#e5e7eb }
    button { padding:10px 14px; border-radius:10px; border:1px solid #334155; background:#1f2937; color:#e5e7eb; cursor:pointer }
    model-viewer { width:100%; height:60vh; border-radius:14px; border:1px solid #22252c; background:#0a0b0f; }
    .row { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); }
    small { color:#94a3b8 }
  </style>
</head>
<body>
  <main>
    <div class="panel">
      <label for="design">Choose a carpet design:</label>
      <select id="design">
        <option value="Berwick_Whitsome.jpg">Berwick Whitsome</option>
        <option value="Chesil_Ammonite.jpg">Chesil Ammonite</option>
        <option value="Chesil_Barnacle.jpg">Chesil Barnacle</option>
        <option value="Chesil_Coral.jpg">Chesil Coral</option>
        <option value="Chesil_Driftwood.jpg">Chesil Driftwood</option>
        <option value="Chesil_Dune.jpg">Chesil Dune</option>
        <option value="Chesil_Gull.jpg">Chesil Gull</option>
        <option value="Chesil_Pebble.jpg">Chesil Pebble</option>
        <option value="Chesil_Seaweed.jpg">Chesil Seaweed</option>
        <option value="Heritage_Bath.jpg">Heritage Bath</option>
        <option value="Heritage_Blaise.jpg">Heritage Blaise</option>
        <option value="Heritage_Castlebourne.jpg">Heritage Castlebourne</option>
        <option value="Heritage_Dinton.jpg">Heritage Dinton</option>
        <option value="Heritage_Greystroke.jpg">Heritage Greystroke</option>
        <option value="Heritage_Midford.jpg">Heritage Midford</option>
        <option value="Heritage_Watchfield.jpg">Heritage Watchfield</option>
        <option value="Heritage_Wyke.jpg">Heritage Wyke</option>
        <option value="test_carpet1.jpg">Test Carpet 1</option>
      </select>
    </div>

    <model-viewer id="mv"
      src="./rug_plane_blank.glb"
      ar
      ar-modes="scene-viewer quick-look webxr"
      camera-controls
      disable-zoom
      exposure="1"
      environment-image="neutral"
      shadow-intensity="0">
      <button slot="ar-button" style="position:absolute; left:16px; bottom:16px;">View in AR</button>
    </model-viewer>

    <div class="panel">
      <small>Select a stock carpet design from the list above.  
      The chosen image will be tiled at 1×1m across the floor plane and clipped to the entered room size.</small>
    </div>
  </main>

<script type="module">
  const mv = document.getElementById('mv');
  const select = document.getElementById('design');

  async function applyTexture(file) {
    try {
      const scene = mv.model?.scene;
      if (!scene) return console.error("No scene yet");

      scene.traverse((node) => {
        if (node.isMesh && node.material && node.material.name === "RugMat") {
          const tex = new THREE.TextureLoader().load(`./textures/${file}`);
          tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
          tex.repeat.set(1, 1); // 1×1m tile repeat
          node.material.map = tex;
          node.material.needsUpdate = true;
        }
      });
    } catch (err) {
      console.error("❌ Failed to apply texture", err);
    }
  }

  // On dropdown change → apply new carpet texture
  select.addEventListener('change', (e) => applyTexture(e.target.value));
  mv.addEventListener('load', () => applyTexture(select.value));
</script>

</body>
</html>
